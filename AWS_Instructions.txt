
La configuration passe par un utilisateur IAM sur la console aws



------- REDIS 

redis-server 





-------- AWS

installer aws-cli 
La configuration passe par un utilisateur IAM défini sur la console aws avec la politique de securité adapté (policy.txt) :

aws configure (accesskeyid, secretaccesskey, region)

positionne les fichiers .aws/ 


installer sam 

brew tap aws/tap
brew install aws-sam-cli


sam --version

faire un fichier template.yaml 
sam validate -t template.yaml

sam build

sam local start-api
(apres avoir lancer docker desktop) 
(on pourra refaire sam build en parallele pour hot loading)

si changement du container : les virer de docker desktop

curl -X POST http://127.0.0.1:3000/transcript \
-H "Content-Type: application/json" \
-d '{"url": "https://respiration-yoga.fr", "etag": "3260-6212906e91527-br", "lastmodifieddate": "Sat, 25 Jan 2025 12:00:00 GMT", "lang": "french"}'


curl -X POST http://127.0.0.1:3000/image-transcript \
-H "Content-Type: application/json" \
--data-binary @test2_request.json


curl -X GET "http://localhost:3000/cache" -H "x-api-key: YOUR_API_KEY"



Utilisation de Ustash pour Redis
https://console.upstash.com/redis/7054ae41-1280-46bb-b8bc-5579cf04eecb?teamid=0
crisp-moray-17911.upstash.io
6379


Créer le bucket s3 si necessaire 
aws s3 mb s3://design-emotion-code

# Construction du layer de dépendances
cd aws
./build_layer.sh
cd ..

# Build des fonctions
sam build

##upload du code sur s3_bucket
sam package  --s3-bucket design-emotion-code --output-template-file packaged.yaml

# deploy
sam deploy --template-file /Users/olivier/dev/design-emotion/aws/packaged.yaml --stack-name design-emotion-dev 
(voir le nom de la stack dans le samconfig.toml)

